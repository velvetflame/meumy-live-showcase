# 雪狐冰灯
> 本项目基于八角老师的数据展示项目进行二次修改，有能力请前去[仓库](https://github.com/K-bai/meumy-live-showcase)支持

## 改动

### 注释
在关键参数进行注释，同步了数据库初始化文件。

### 前端修改
* 排行榜所有人员显示弹幕数量（原版仅前三展示），调整排行榜布局
* 日期选择浮动至左下角
* 数据板块顺序调整
* 引用cdn的第三方fonts/js文件全部拉回本地

### 触发方式

原设计为`danmu_analyse.py`内部定时循环，程序全量更新`{roomid}-{date}.json`，根据开播时间时长和弹幕数量，占用的内存会逐步提升。长时间有内存溢出进程关闭风险（仅对于小内存服务器）<br>
于是将`danmu_analyse.py`改为单次分析，crontab定时计划任务

```sh
crontab -e
```
示例（每5分钟执行一次弹幕分析）
```vim
*/5 * * * * cd [path] && python danmu_analyse.py 
```
# Meumy直播弹幕数据展示页(以下是原项目文档)

本项目分为静态网页部分和数据处理服务器两部分，纯业余。

## 静态网页
使用了bootstrap5框架、`vue.js`和`echart.js`。

## 数据处理服务器
### live_listener.py
使用了`bilibili-api`这个包把直播弹幕数据记录到sqlite数据库中，可以同时监听多个直播间的数据。

### Msg_db.py
一个记录弹幕、礼物、直播时间信息的sqlite数据库的简易类。使用peewee作为ORM引擎。会把每天的数据分别存到不同的文件中。

### danmu_analyse.py
每十分钟扫描今日的弹幕数据库，如果发现已开播就对弹幕进行分析，生成用于网页显示的json数据文件。

* 使用`scipy`包对弹幕量进行平滑以及峰值识别
* 使用`jieba`包进行中文分词和关键词提取
    * 用正则表达式过滤掉一些垃圾弹幕，比如ohhhhhhhh
    * 其中使用自定义词典`user_dict.txt`对分词进行了一点点优化
    * 分词部分还需要调整，有些词无法识别，需要经常维护自定义词典
    * 关键词识别不太适用于网络用语较多的环境，关键词全是“哈哈哈”，我也没啥办法
* 用正则表达式识别打call弹幕，从而识别出up唱歌的时段
* 用以往弹幕数据计算了一个新的idf词典`idf/idf_live.txt`，试图按直播弹幕词频来分析最新直播弹幕关键词，但似乎并不是很有效。有效的例子是呜米2021年9月10日关键词是“确实”，这个确实提取出来了
